<div class="min-h-screen bg-background-light relative overflow-hidden flex flex-col items-center py-10 px-4 sm:px-6">

    <!-- Decorative Background Blobs (taken from landing-hero) -->
    <div class="absolute top-0 left-0 w-96 h-96 bg-accent-purple/20 rounded-full blur-3xl animate-blob -z-10"></div>
    <div
        class="absolute top-40 right-0 w-80 h-80 bg-card-yellow/20 rounded-full blur-3xl animate-blob animation-delay-2000 -z-10">
    </div>
    <div
        class="absolute bottom-0 left-1/4 w-96 h-96 bg-primary/10 rounded-full blur-3xl animate-blob animation-delay-4000 -z-10">
    </div>

    @if (loading) {
    <div class="flex flex-col items-center justify-center min-h-[60vh] gap-4 z-10">
        <div class="w-12 h-12 border-4 border-gray-200 border-t-primary rounded-full animate-spin"></div>
        <p class="text-gray-500 font-medium animate-pulse">Cargando tu experiencia...</p>
    </div>
    } @else {

    <!-- Navbar / Header -->
    <header class="w-full max-w-5xl flex justify-between items-center mb-10 z-10">
        <div class="flex items-center gap-2 select-none">
            <span class="material-icons-outlined text-primary text-3xl">rocket_launch</span>
            <span class="text-2xl font-bold font-display tracking-tight text-accent-dark">
                Skill<span class="text-primary">Main</span>
            </span>
        </div>
        <button (click)="saveAndContinueLater()" [disabled]="saving"
            class="hidden sm:flex items-center gap-2 px-6 py-2 rounded-full border border-gray-200 bg-white/50 backdrop-blur-sm text-gray-600 font-medium hover:bg-white hover:text-primary hover:border-primary transition-all text-sm">
            {{ saving ? 'Guardando...' : 'Completar más tarde' }}
        </button>
    </header>

    <!-- Main Content Container -->
    <main class="w-full max-w-4xl z-10 relative">

        <!-- Progress Bar Section -->
        <div class="mb-12">
            <div class="flex justify-between text-sm font-semibold text-gray-500 mb-4 px-2">
                <span>Paso {{ currentStep + 1 }} de 4</span>
                <span class="text-primary">{{ progress }}% Completado</span>
            </div>
            <div class="h-3 w-full bg-gray-200 rounded-full overflow-hidden">
                <div class="h-full bg-primary rounded-full transition-all duration-500 ease-out shadow-[0_0_10px_rgba(255,87,52,0.4)]"
                    [style.width.%]="progress"></div>
            </div>

            <!-- Visual Step Indicators -->
            <div class="flex justify-between items-center mt-6 px-2 sm:px-10">
                <div *ngFor="let step of [0, 1, 2, 3]; let i = index" (click)="goToStep(step)"
                    class="flex flex-col items-center gap-2 cursor-pointer group transition-all duration-300"
                    [class.opacity-50]="currentStep < i" [class.opacity-100]="currentStep >= i">

                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-2xl flex items-center justify-center transition-all duration-300 shadow-md transform group-hover:scale-110"
                        [ngClass]="{
                   'bg-primary text-white shadow-primary/30': currentStep === i,
                   'bg-white text-gray-400': currentStep !== i,
                   'bg-green-500 text-white': currentStep > i
                 }">
                        <span class="font-bold font-display text-lg">
                            @if(currentStep > i) { ✓ } @else { {{ i + 1 }} }
                        </span>
                    </div>
                    <span class="text-xs font-semibold hidden sm:block transition-colors"
                        [ngClass]="{'text-primary': currentStep === i, 'text-gray-400': currentStep !== i}">
                        {{ ['Intereses', 'Habilidades', 'Experiencia', 'Educación'][i] }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Content Card -->
        <div
            class="bg-white/80 backdrop-blur-xl rounded-[2.5rem] shadow-2xl shadow-black/5 border border-white p-6 sm:p-10 lg:p-12 min-h-[500px] flex flex-col relative overflow-visible">

            <!-- Header del Paso -->
            <div class="text-center mb-10">
                <div
                    class="w-16 h-16 sm:w-20 sm:h-20 mx-auto bg-gradient-to-tr from-primary/10 to-card-yellow/20 rounded-3xl flex items-center justify-center mb-6 shadow-sm">
                    <span class="text-4xl sm:text-5xl">{{ getStepIcon() }}</span>
                </div>
                <h2 class="text-3xl sm:text-4xl font-bold font-display text-accent-dark mb-4">
                    {{ getStepTitle() }}
                </h2>
                <p class="text-gray-500 text-lg max-w-lg mx-auto leading-relaxed">
                    @if(currentStep === 0) { Selecciona las áreas donde quieres crecer profesionalmente. }
                    @if(currentStep === 1) { Destaca tus fortalezas actuales para personalizar tu experiencia. }
                    @if(currentStep === 2) { Cuéntanos sobre tu trayectoria laboral relevante. }
                    @if(currentStep === 3) { Tu formación académica es parte importante de tu perfil. }
                </p>
            </div>

            <!-- Step 1: Intereses (Chips Grid) -->
            @if (currentStep === 0) {
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                <div *ngFor="let interest of availableInterests" (click)="toggleInterest(interest)"
                    class="relative p-4 rounded-2xl border-2 cursor-pointer transition-all duration-200 group overflow-hidden"
                    [ngClass]="{
                   'border-primary bg-primary/5 shadow-lg shadow-primary/10': isInterestSelected(interest),
                   'border-transparent bg-gray-50 hover:bg-white hover:border-gray-200 hover:shadow-md': !isInterestSelected(interest)
                 }">
                    <div class="flex items-center justify-between relative z-10">
                        <span class="font-semibold text-sm sm:text-base pr-2"
                            [ngClass]="isInterestSelected(interest) ? 'text-primary' : 'text-gray-700'">
                            {{ interest.nombre }}
                        </span>
                        <span class="material-icons-outlined text-xl transition-transform duration-300"
                            [ngClass]="isInterestSelected(interest) ? 'text-primary scale-110' : 'text-gray-300 group-hover:text-gray-400'">
                            {{ isInterestSelected(interest) ? 'check_circle' : 'add_circle_outline' }}
                        </span>
                    </div>
                </div>
            </div>
            }

            <!-- Step 2: Habilidades (Chips Grid) -->
            @if (currentStep === 1) {
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                <div *ngFor="let skill of availableSkills" (click)="toggleSkill(skill)"
                    class="relative p-4 rounded-2xl border-2 cursor-pointer transition-all duration-200 group"
                    [ngClass]="{
                   'border-accent-purple bg-accent-purple/5 shadow-lg shadow-accent-purple/10': isSkillSelected(skill),
                   'border-transparent bg-gray-50 hover:bg-white hover:border-gray-200 hover:shadow-md': !isSkillSelected(skill)
                 }">
                    <div class="flex items-center justify-between relative z-10">
                        <span class="font-semibold text-sm sm:text-base pr-2"
                            [ngClass]="isSkillSelected(skill) ? 'text-accent-purple' : 'text-gray-700'">
                            {{ skill.nombre }}
                        </span>
                        <span class="material-icons-outlined text-xl transition-transform duration-300"
                            [ngClass]="isSkillSelected(skill) ? 'text-accent-purple scale-110' : 'text-gray-300 group-hover:text-gray-400'">
                            {{ isSkillSelected(skill) ? 'verified' : 'circle' }}
                        </span>
                    </div>
                </div>
            </div>
            }

            <!-- Step 3: Experiencia (Formulario) -->
            @if (currentStep === 2) {
            <div class="space-y-6 max-w-2xl mx-auto w-full">

                <!-- Cards de items agregados -->
                <div *ngIf="state.experiences.length > 0" class="flex flex-col gap-4 mb-6">
                    <div *ngFor="let exp of state.experiences"
                        class="bg-white border border-gray-100 p-5 rounded-2xl shadow-sm flex justify-between items-start animate-fade-in-up">
                        <div>
                            <h4 class="font-bold text-accent-dark text-lg">{{ exp.cargo }}</h4>
                            <p class="text-primary font-medium">{{ exp.nombreEmpresa }}</p>
                            <p class="text-sm text-gray-400 mt-1">
                                {{ exp.fechaInicio | date:'MMM yyyy' }} - {{ exp.fechaFin ? (exp.fechaFin | date:'MMM
                                yyyy') : 'Actualidad' }}
                            </p>
                        </div>
                        <button (click)="removeExperience(exp.uid)"
                            class="text-red-400 hover:text-red-600 p-2 hover:bg-red-50 rounded-xl transition-colors">
                            <span class="material-icons-outlined">delete_outline</span>
                        </button>
                    </div>
                </div>

                <!-- Formulario -->
                <div class="bg-gray-50/80 p-6 sm:p-8 rounded-3xl border border-gray-100">
                    <h4 class="font-bold text-gray-700 mb-6 flex items-center gap-2">
                        <span class="material-icons-outlined text-primary">add_circle</span>
                        Agregar Nueva Experiencia
                    </h4>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                        <div class="space-y-2">
                            <label class="text-sm font-semibold text-gray-600 ml-1">Cargo</label>
                            <input type="text" [(ngModel)]="newExperience.cargo" placeholder="Ej: Product Designer"
                                class="w-full px-5 py-3.5 bg-white border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-4 focus:ring-primary/10 outline-none transition-all font-medium text-gray-700 placeholder-gray-400">
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-semibold text-gray-600 ml-1">Empresa</label>
                            <input type="text" [(ngModel)]="newExperience.nombreEmpresa" placeholder="Ej: Airbnb"
                                class="w-full px-5 py-3.5 bg-white border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-4 focus:ring-primary/10 outline-none transition-all font-medium text-gray-700 placeholder-gray-400">
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-semibold text-gray-600 ml-1">Inicio</label>
                            <input type="date" [(ngModel)]="newExperience.fechaInicio"
                                class="w-full px-5 py-3.5 bg-white border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-4 focus:ring-primary/10 outline-none transition-all font-medium text-gray-700 text-base">
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-semibold text-gray-600 ml-1">Fin (Opcional)</label>
                            <input type="date" [(ngModel)]="newExperience.fechaFin"
                                class="w-full px-5 py-3.5 bg-white border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-4 focus:ring-primary/10 outline-none transition-all font-medium text-gray-700 text-base">
                        </div>

                        <div class="col-span-1 sm:col-span-2 space-y-2">
                            <label class="text-sm font-semibold text-gray-600 ml-1">Descripción</label>
                            <textarea [(ngModel)]="newExperience.descripcion" rows="3"
                                placeholder="Logros y responsabilidades..."
                                class="w-full px-5 py-3.5 bg-white border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-4 focus:ring-primary/10 outline-none transition-all font-medium text-gray-700 placeholder-gray-400 resize-none"></textarea>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button (click)="addExperience()"
                            [disabled]="!newExperience.cargo || !newExperience.nombreEmpresa"
                            class="bg-accent-dark text-white px-6 py-3 rounded-xl font-bold hover:opacity-90 transition-all shadow-lg flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span>Agregar</span>
                            <span class="material-icons-outlined text-sm">arrow_forward</span>
                        </button>
                    </div>
                </div>
            </div>
            }

            <!-- Step 4: Educación (Formulario) -->
            @if (currentStep === 3) {
            <div class="space-y-6 max-w-2xl mx-auto w-full">

                <!-- Cards de items agregados -->
                <div *ngIf="state.studies.length > 0" class="flex flex-col gap-4 mb-6">
                    <div *ngFor="let study of state.studies"
                        class="bg-white border border-gray-100 p-5 rounded-2xl shadow-sm flex justify-between items-start animate-fade-in-up">
                        <div>
                            <h4 class="font-bold text-accent-dark text-lg">{{ study.titulo }}</h4>
                            <p class="text-accent-purple font-medium">{{ study.nombreInstitucion }}</p>
                            <p class="text-sm text-gray-400 mt-1">
                                {{ study.fechaInicio | date:'MMM yyyy' }} - {{ study.fechaFin ? (study.fechaFin |
                                date:'MMM yyyy') : 'Actualidad' }}
                            </p>
                        </div>
                        <button (click)="removeStudy(study.uid)"
                            class="text-red-400 hover:text-red-600 p-2 hover:bg-red-50 rounded-xl transition-colors">
                            <span class="material-icons-outlined">delete_outline</span>
                        </button>
                    </div>
                </div>

                <!-- Formulario -->
                <div class="bg-gray-50/80 p-6 sm:p-8 rounded-3xl border border-gray-100">
                    <h4 class="font-bold text-gray-700 mb-6 flex items-center gap-2">
                        <span class="material-icons-outlined text-accent-purple">school</span>
                        Agregar Nueva Formación
                    </h4>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                        <div class="space-y-2">
                            <label class="text-sm font-semibold text-gray-600 ml-1">Título</label>
                            <input type="text" [(ngModel)]="newStudy.titulo" placeholder="Ej: Máster en Data Science"
                                class="w-full px-5 py-3.5 bg-white border-2 border-gray-200 rounded-xl focus:border-accent-purple focus:ring-4 focus:ring-accent-purple/10 outline-none transition-all font-medium text-gray-700 placeholder-gray-400">
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-semibold text-gray-600 ml-1">Institución</label>
                            <input type="text" [(ngModel)]="newStudy.nombreInstitucion"
                                placeholder="Ej: Stanford Online"
                                class="w-full px-5 py-3.5 bg-white border-2 border-gray-200 rounded-xl focus:border-accent-purple focus:ring-4 focus:ring-accent-purple/10 outline-none transition-all font-medium text-gray-700 placeholder-gray-400">
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-semibold text-gray-600 ml-1">Inicio</label>
                            <input type="date" [(ngModel)]="newStudy.fechaInicio"
                                class="w-full px-5 py-3.5 bg-white border-2 border-gray-200 rounded-xl focus:border-accent-purple focus:ring-4 focus:ring-accent-purple/10 outline-none transition-all font-medium text-gray-700 text-base">
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-semibold text-gray-600 ml-1">Fin (Opcional)</label>
                            <input type="date" [(ngModel)]="newStudy.fechaFin"
                                class="w-full px-5 py-3.5 bg-white border-2 border-gray-200 rounded-xl focus:border-accent-purple focus:ring-4 focus:ring-accent-purple/10 outline-none transition-all font-medium text-gray-700 text-base">
                        </div>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button (click)="addStudy()" [disabled]="!newStudy.titulo || !newStudy.nombreInstitucion"
                            class="bg-accent-dark text-white px-6 py-3 rounded-xl font-bold hover:opacity-90 transition-all shadow-lg flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span>Agregar</span>
                            <span class="material-icons-outlined text-sm">arrow_forward</span>
                        </button>
                    </div>
                </div>
            </div>
            }

            <!-- Footer / Navigation -->
            <div class="mt-auto pt-10 flex items-center justify-between border-t border-gray-100/50">
                <button (click)="previousStep()" [disabled]="currentStep === 0"
                    class="px-6 py-3 rounded-xl font-bold text-gray-500 hover:text-accent-dark hover:bg-gray-50 transition-all flex items-center gap-2 disabled:opacity-0">
                    <span class="material-icons-outlined">arrow_back</span>
                    Anterior
                </button>

                <div class="flex items-center gap-4">
                    @if (currentStep < 3) { <button (click)="nextStep()" [disabled]="!canProceed()"
                        class="bg-primary text-white px-8 py-4 rounded-xl font-bold hover:shadow-lg hover:shadow-primary/30 hover:-translate-y-1 transition-all flex items-center gap-2 shadow-md">
                        Siguiente
                        <span class="material-icons-outlined">arrow_forward</span>
                        </button>
                        } @else {
                        <button (click)="completeOnboarding()" [disabled]="saving || !canProceed()"
                            class="bg-green-500 text-white px-8 py-4 rounded-xl font-bold hover:shadow-lg hover:shadow-green-500/30 hover:-translate-y-1 transition-all flex items-center gap-2 shadow-md">
                            {{ saving ? 'Completando...' : 'Finalizar Todo' }}
                            <span class="material-icons-outlined">check_circle</span>
                        </button>
                        }
                </div>
            </div>

        </div>

        <!-- Footer simple -->
        <footer class="text-center mt-10 text-gray-400 text-sm">
            <p>&copy; 2026 SkillMain. Todos los derechos reservados.</p>
        </footer>
    </main>
    }
</div>